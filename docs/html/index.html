<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TOSCA: TOSCA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TOSCA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TOSCA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="mainpage"></a></p>
<div class="image">
<img src="tosca.png" alt="" width="400px"/>
</div>
 <p>Toolbox fOr Stratified Convective Atmospheres</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Recent Highlights/Additions</h1>
<pre class="fragment">- Direct/Indirect profile assimilation techniques to drive LES with observations/mesoscale models
- New scale-dependent LES model
- New stability dependent wall model for IBM
- IBM also for concurrent precursor (to model terrain features)
- Lateral fringe region.
</pre><p> Now we can simulate real cases, wind rotating 360 degs, with terrain and turbines, all while damping gravity waves in all directions !!</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Executables</h1>
<pre class="fragment">- tosca    : transient solver for stratified incompressible flows. Temperature stratification is accounted via Boussinesq approximation.
- tosca2PV : post processor for ParaView visualization. Writes data in XMF/HDF format.
</pre> <h1><a class="anchor" id="autotoc_md2"></a>
Boundary Conditions</h1>
<pre class="fragment">- noSlip               : on all patches
- slip                 : on all patches
- zeroGradient         : on all patches
- fixedGradient        : on all patches (only T equation)
- inflowFunction       : only on kLeft patch. Different types of inflow can be prescribed: ABL inflow using teorethical laws, mapped inflow from a precursor
                         simulation that can be also periodized and/or interpolated if meshes are not consistent.
- velocityWallFunction : shear stress model (only U equation). Can be prescribed on jRight and jLeft patches
- thetaWallFunction    : potential temperature wall model (only T equation). Can be prescribed on jRight and jLeft patches
</pre> <h1><a class="anchor" id="autotoc_md3"></a>
Wall Models</h1>
<pre class="fragment">- Shumann    : applies wall shear stress in the momentum equation according to similarity theory of Paulson and Obuhkov.
               Velocity BC is dependent (velocityWallFunction/thetaWallFunction, type -3).
- Cabot      : prescribes velocity BC according to Cabot formulation (velocityWallFunction, type -1).
</pre> <h1><a class="anchor" id="autotoc_md4"></a>
Turbulence Models</h1>
<pre class="fragment">- Smagorinsky standard model (les 1).
- Dynamic Smagorinsky LES turbulence model with cubic (les 3) or lagrangian (les 4) averaging.
</pre> <h1><a class="anchor" id="autotoc_md5"></a>
Turbine Models</h1>
<pre class="fragment">- UADM : base actuator disk model with imposed Ct and yaw controller
- ADM  : advanced actuator disk model with rotor dynamics and yaw/pitch/rotation controllers
- ALM  : advanced actuator line model with rotor dynamics and yaw/pitch/rotation controllers (anisotropic gaussuan projection avail.)
- AFM  : anisotropic actuator farm model for coarser meshes, integral/point sampling available
</pre> <h1><a class="anchor" id="autotoc_md6"></a>
IBM Method</h1>
<pre class="fragment">TOSCA uses a sharp-interface IBM method with ghost cells applied on the flow side of the body. This allows for more flexibility with
thin bodies but complicated wall modeling. New wall models have been recently added, validated with both hi-Re terrains (Shumann) or small objects (Cabot).
Moving IBM is also possible, we are currently validating the latter capability.
</pre> <h1><a class="anchor" id="autotoc_md7"></a>
Acquisition System</h1>
<pre class="fragment">- ABL wall-parallel planes-averaged statistics as a function of time
- field averages
- domain sections
- probes with advanced parallel I/O writing
- turbine data with advanced parallel I/O writing
- ABL perturbations w.r.t. reference state
- layer averaged fields (three layers available - 3LM)
- mechanical energy budgets within user-defined boxes (the code is not energy-conservative so MKE eq. is not fullfilled)
</pre> <h1><a class="anchor" id="autotoc_md8"></a>
Future Implementations:</h1>
<pre class="fragment">- Overset with fringe interpolation
- IBM smooth normals and thin-body augmented search
</pre> <h1><a class="anchor" id="autotoc_md9"></a>
Notes:</h1>
<pre class="fragment">- test cases which contain an empty 'inflowDatabase' file require the inflow database. A sample database can be downloaded
  at https://drive.google.com/file/d/17F5wtI5Jc1XGh8crmOVJYVXabC8iQXq1/view?usp=sharing, simply substitute the 'inflowDatabase'
  file with the downloaded folder.
</pre> <h1><a class="anchor" id="autotoc_md10"></a>
Installation:</h1>
<p>In order to be installed, TOSCA requires a working C/C++ compiler, PETSc (version 3.14.x, 3.15.x), Open MPI (version 4.0.x, 4.1.x), HDF5 and HYPRE (needed by PETSs in order to build some of the matrix solvers we use). TOSCA has been tested with the above version combinations, it could work with other combinations or versions but it has not been tested (especially older versions). We recommend the following versions of the above libraries:</p><ul>
<li>gcc : 9.2.0 (<a href="https://gcc.gnu.org/">https://gcc.gnu.org/</a>).</li>
<li>PETSc : 3.15.5 (<a href="https://ftp.mcs.anl.gov/pub/petsc/">https://ftp.mcs.anl.gov/pub/petsc/</a>).</li>
<li>Open MPI : 4.1.2 (<a href="https://www.open-mpi.org/software/ompi/v4.1/">https://www.open-mpi.org/software/ompi/v4.1/</a>).</li>
<li>HYPRE : 2.20.0 (<a href="https://github.com/hypre-space/hypre/tree/hypre_petsc">https://github.com/hypre-space/hypre/tree/hypre_petsc</a>) (check version in /src/CMakeLists.txt).</li>
<li>HDF5 : 1.12.1 (<a href="https://www.hdfgroup.org/downloads/hdf5/">https://www.hdfgroup.org/downloads/hdf5/</a>).</li>
</ul>
<p>Prior to install TOSCA, we suggest to create a folder named <code>Software</code> inside <code>$HOME</code>, where the PETSc, HYPRE and TOSCA folders will be located. In order to compile TOSCA on your system, please follow these steps:</p>
<ul>
<li>Check your compiler version with <code>gcc --version</code></li>
<li>Download PETSc into <code>$HOME/Software/</code></li>
<li>Download HYPRE <code>$HOME/Software/</code></li>
<li>Download Open MPI: you can download the binaries or compile from source (the latter is recommended if use <code>environment-modules</code>). If you have only one version of Open MPI installed on your system in the <code>/usr</code> directory (using sudo for example), you can omit the &lsquo;--with-mpi-dir='your--path--to--mpicc&rsquo;&lsquo; at point 4: Open MPI will be found by the 'ld&rsquo; library locator.</li>
<li>Configure PETSc (will automatically compile HYPRE). We suggest the following configure options: &lsquo;./configure --with-fc=0 --download-f2cblaslapack --with-mpi-dir='your--path--to--mpicc&rsquo; &ndash;download-hypre='your&ndash;path&ndash;to&ndash;hypre \ &ndash;with-64-bit-indices=1 &ndash;with-debugging=0`</li>
<li>Make PETSc with <code>make all</code></li>
<li>Test PETSc with <code>make check</code></li>
<li>Save an environment variable that will tell TOSCA where PETSc is installed in your .bashrc: <code>echo "export PETSC_DIR=$HOME/your--path--to--petsc" &gt;&gt; $HOME/.bashrc</code></li>
<li>Save an environment variable that will tell TOSCA which PETSc architecture is required in your .bashrc. Note: this is the folder within $PETSC_DIR with a name beginning with "arch-". In a typical installation, it will be "arch-linux-c-opt": <code>echo "export PETSC_ARCH=arch-linux-c-opt" &gt;&gt; $HOME/.bashrc</code></li>
<li>Add the PETSc shared libraries to your library path environment variable in your .bashrc: <code>echo "export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$PETSC_DIR/$PETSC_ARCH/lib" &gt;&gt; $HOME/.bashrc</code></li>
<li>Reload the environment with <code>source $HOME/.bashrc</code></li>
<li>Go inside TOSCA/src directory and compile the executables with <code>make tosca</code> and <code>make tosca2PV</code></li>
<li>Test the installation by copying <code>tosca</code> and <code>tosca2PV</code> in one of the example cases and run the simulation and the post-processing with <code>./tosca</code> and <code>./tosca2PV</code> respectively. To run in parallel you have to use &lsquo;mpirun -np 'your-number-of-processors&rsquo; ./tosca`</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
Contribute to the TOSCA Project</h1>
<p>The TOSCA repository is open-source, so anyone can download and use the code. If you want to contribute to the project by adding code to TOSCA repository you need to open a pull-request that has to be approved by our team. In order to do so, please use the following steps:</p>
<ul>
<li>Clone the TOSCA package locally on your machine with <code>git clone <a href="https://github.com/sebastipa/TOSCA.git">https://github.com/sebastipa/TOSCA.git</a></code></li>
<li>Create a new local branch with <code>git checkout -b your-branch-name</code></li>
<li>Make the desired changes to the TOSCA code, then check which files have been modified with <code>git status</code></li>
<li>Add changes to the git stack with <code>git add modified-files</code></li>
<li>Commit the changes using a short but exhaustive comment with <code>git commit -m "your-commit-description"</code></li>
<li>Push your local branch online with <code>git push origin your-branch-name</code></li>
<li>Go to github, select your branch, click on "Contribute" and open a pull-request describing the motivation of your changes, their effect on the code and the tests you performed.</li>
<li>After approval of the pull-request by our team, commits will be added to the main TOSCA version</li>
<li>To stay up-to-date, rebase your local master with the your new commits by first checking out in your local master branch with <code>git checkout master</code> and then rebase with <code>git pull --rebase origin master</code></li>
<li>Delete your local branch as it is not useful anymore with <code>git branch --delete -d your-branch-name</code> and operate on the master until you want to make new changes</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
Paraview-Catalyst2 OS-Rendering</h1>
<p>TOSCA provides full interface with Paraview-catalyst2 through the USE_CATALYST flag in the makefile. If this is the case, the CATALYST environment variable should point to the catalyst2 installation directory. Paraview-catalyst is optional and can be disabled by setting USE_CATALYST=0</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Usage</h1>
<p>In order to activate off-screen rendering capabilities, -pvCatalyst=1 should be set in the control.dat file. A file called catalystProperties will be required inside the sampling directory. Entries to this file are</p>
<ul>
<li>ioType can be set to 'script' or 'general'</li>
<li>outputType can be set to 'timeStep' or 'adjustableTime'</li>
<li>startTime model-time at which catalyst actions start</li>
<li>timeInterval acquisition period in seconds if outputType=adjustableTime or iterations if outputType=timeStep</li>
<li>scriptName name of the catalyst actions python script. Only required if ioType=script</li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
What does it do</h1>
<p>If ioType=general, 3D fields of velocity magnitude, pressure and q-criterion are saved inside the catalyst/ folder. If ioType=script, Praview actions defined in the python script are executed and e.g. png images can be saved at runtime.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Installation:</h1>
<p>In order to be installed, Paraview-catalyst2 requires a working C/C++ compiler, Open MPI (version 4.0.x, 4.1.x), Python3 and cmake. In order for Paraview to work, OpenGL must be available at runtime or mesa libraries are required to mimic some hardware components. These are usually available on supercomputers through the 'mesa' module, which should be loaded at runtime. Lastly, paraview and catalyst2 should be manually compiled of the system. As Paraview-5.10 contains a bug in the definition of rectilinear mesh (used by TOSCA), Paraview-5.11 or later is recommended.</p>
<p>Prior to install TOSCA, we suggest to create a folder named <code>Software</code> inside <code>$HOME</code>, where catalyst2 and paraview-5.11 will be located. In order to re-compile TOSCA with Paraview-catalyst2 capabilities on your system, please follow these steps:</p>
<h1><a class="anchor" id="autotoc_md16"></a>
1. install Catalyst2</h1>
<ul>
<li><code>export LOCATION=$HOME/Software</code></li>
<li><code>cd $LOCATION</code></li>
<li><code>mkdir catalyst2 &amp;&amp; cd catalyst2</code></li>
<li><code>git clone <a href="https://gitlab.kitware.com/paraview/catalyst.git">https://gitlab.kitware.com/paraview/catalyst.git</a> catalyst-src &amp;&amp; cd catalyst-src</code></li>
<li><code>mkdir -p build &amp;&amp; cd build</code></li>
<li><code>cmake .. -DCMAKE_INSTALL_PREFIX=$LOCATION/catalyst2/install</code></li>
<li><code>make</code></li>
<li><code>make install</code></li>
<li><code>echo "export CATALYST=$LOCATION" &gt;&gt; $HOME/.bashrc</code></li>
<li>Add the Catalyst2 shared libraries to your library path environment variable in your .bashrc: <code>echo "export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$LOCATION/catalyst2/install/lib" &gt;&gt; $HOME/.bashrc</code> Note: in some cases you may have to replace lib with lib64</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
2. install Paraview-5.11</h1>
<ul>
<li><code>cd $LOCATION</code></li>
<li><code>mkdir paraview-5.11.0 &amp;&amp; cd paraview-5.11.0</code></li>
<li><code>wget <a href="https://www.paraview.org/files/v5.11/ParaView-v5.11.0.tar.xz">https://www.paraview.org/files/v5.11/ParaView-v5.11.0.tar.xz</a></code></li>
<li><code>tar -xvf ParaView-v5.11.0.tar.xz</code></li>
<li><code>mv ParaView-v5.11.0 paraview-src &amp;&amp; cd paraview-src</code></li>
<li><code>mkdir -p build &amp;&amp; cd build</code></li>
<li><code>export CMAKE_PREFIX_PATH=$CMAKE_PREFIX_PATH:$LOCATION/catalyst2/install/lib/cmake/catalyst-2.0</code> Note: in some cases you may have to replace lib with lib64</li>
<li><code>FLAGS=(-DCMAKE_INSTALL_PREFIX=$LOCATION/paraview-5.11.0/install -DVTK_OPENGL_HAS_OSMESA=ON -DPARAVIEW_USE_MPI=ON -DBUILD_TESTING=OFF -DVTK_USE_X=OFF -DPARAVIEW_USE_QT=OFF -DPARAVIEW_USE_PYTHON=ON -DPython3_FIND_STRATEGY=LOCATION -DPython3_ROOT_DIR=$EBROOTPYTHON -DPARAVIEW_BUILD_SHARED_LIBS=ON -DPARAVIEW_ENABLE_RAYTRACING=OFF -DPARAVIEW_ENABLE_CATALYST=ON )</code></li>
<li><code>cmake .. "${FLAGS[@]}"</code></li>
<li><code>make -j8</code></li>
<li><code>make install</code></li>
<li>Add the Paraview shared libraries to your library path environment variable in your .bashrc: <code>echo "export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$LOCATION/paraview-5.11.0/install/lib" &gt;&gt; $HOME/.bashrc</code> Note: in some cases you may have to replace lib with lib64</li>
</ul>
<h1><a class="anchor" id="autotoc_md18"></a>
3. Re-compile TOSCA</h1>
<ul>
<li>Reload the environment with <code>source $HOME/.bashrc</code></li>
<li>Go inside <code>TOSCA/src</code> directory and recompile the solver with <code>make tosca</code> ensuring that <code>-DUSE_CATALYST=1</code> in the makefile</li>
</ul>
<h1><a class="anchor" id="autotoc_md19"></a>
4. Running</h1>
<p>In order for catalyst2 to find paraview library, the following envronment variables should be set at runtime:</p>
<ul>
<li><code>export CATALYST_IMPLEMENTATION_PATHS=$LOCATION/paraview-5.11.0/install/lib/catalyst</code> Note: in some cases you may have to replace lib with lib64</li>
<li><code>export CATALYST_IMPLEMENTATION_NAME=paraview</code></li>
</ul>
<p>Credits and Copyright: Sebastiano Stipa - Arjun Ajay - Mohammad Hadi - The University of British Columbia </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
